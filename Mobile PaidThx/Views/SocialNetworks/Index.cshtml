@model Mobile_PaidThx.Models.SocialNetworksModels.Index
@{
    ViewBag.Title = "Social Networks";
}
<div  id="socialnetworks-page"   >
    
    <div data-role="header" data-position="fixed" class="header-pdthx" >
             
        <h1>
            Social Networks</h1>
    </div>
    <div data-role="content">
        <div style="margin: 5px; padding: 10px; background-color: #FFFFFF">

            @TempData["Message"]

            <!-- Edit Profile -->
            <ul data-role="listview" data-inset="true">
                <li class="settings" id="socials">
                @if (Model.UserSocialNetworks.FirstOrDefault(u => u.Name == "Facebook") == null)
                {
                
                    <!-- Separate Set -->
                    <!-- Email Accounts -->
                    <a href='https://www.facebook.com/dialog/oauth?client_id=332189543469634&redirect_uri=@Html.FormatCallbackUrl(Request.Url.Scheme + System.Uri.SchemeDelimiter + Request.Url.Host + Url.Content("~/"), "SocialNetworks/LinkFacebookAccount/&scope=email&state=", Model.FBState)'>
                    <h2 class="heading"> Facebook </h2>
                    <h4 class="subheading">Send/Request money with your facebook friends</h4> </a>
                }
                else
                {
                    <!-- Separate Set -->
                    <!-- Email Accounts -->
                    <div id="remove-facebook-account">
                    <h2 class="heading"> Facebook </h2>
                    <h4 class="subheading">Send/Request money with your facebook friends - Linked</h4>
                    </div>
                }
                </li>
            </ul>
        </div>
    </div>
    <script language="javascript">
        //wait to do event binding until the page is being initialized
        //wait to do event binding until the page is being initialized
        var socialNeworkController = (function ($, undefined) {
            var pub = {},
            $this = $(this);

            pub.init = function () {

            };

            pub.removeFacebookAccount = function () {
                //Starting loading animation
                $.mobile.showPageLoadingMsg();

                //Get news and add success callback using then
                removeFacebookAccount(function () {
                    //Stop loading animation on success
                    $.mobile.changePage(getBaseURL() + 'SocialNetworks/Index');

                    $.mobile.hidePageLoadingMsg();
                });
            };

            function removeFacebookAccount(callback) {
                //Get news via ajax and return jqXhr
                $.ajax({
                    url: getBaseURL() + 'SocialNetworks/UnlinkFacebookAccount',
                    dataType: "json",
                    success: function (data, textStatus, xhr) {
                        //Publish that news has been updated & allow
                        //the 2 subscribers to update the UI content
                        if (callback) callback(data);
                    },
                    error: function (data, textStatus, xhr) {
                        //Publish that news has been updated & allow
                        //the 2 subscribers to update the UI content
                        if (callback) callback(data);
                    }
                });
            }


            return pub;
        } (jQuery));
        $("#socialnetworks-page").unbind('pageshow').bind('pageshow', function () {
            
            socialNeworkController.init();

            $("#remove-facebook-account").unbind("click").bind("click", function () {
                socialNeworkController.removeFacebookAccount();
            });
        });

</script>
</div>

