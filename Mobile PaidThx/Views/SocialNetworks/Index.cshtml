@model Mobile_PaidThx.Models.SocialNetworksModels.Index
@{
    ViewBag.Title = "Social Networks";
    ViewBag.PageID = "social-networks-page";
    ViewBag.Classes = "page";
}
<div  id="@ViewBag.PageID" class="@ViewBag.Classes" >
    
    <div class="header-pdthx" >
             
        <h1>
            Social Networks</h1>
            <a href="@Url.Content("~/Preferences")"  class="hd-btn-left btn-back">Back</a>
    </div>
    <div class="pd-content">
        <div class="pad">

            @TempData["Message"]

            <!-- Edit Profile -->
            <ul class="panel-container">
                
                @{
                
               if (Model.UserSocialNetworks.FirstOrDefault(u => u.Name == "Facebook") == null)
                {
                               <li class="settings unlinked" id="facebook">
                    <!-- Facebook -->
                    <a href='https://www.facebook.com/dialog/oauth?client_id=332189543469634&redirect_uri=@Html.FormatCallbackUrl(Request.Url.Scheme + System.Uri.SchemeDelimiter + Request.Url.Host + Url.Content("~/"), "SocialNetworks/LinkFacebookAccount/&scope=email&state=", Model.FBState)'>
                    <h2 class="heading"> Facebook </h2>
                    <h4 class="subheading">Send to your friends! Click to link.</h4> </a>
                    </li>
                }
               else
               {
                    <li class="settings linked" id="facebook">
                    <!-- Facebook Not Linked -->
                    <a href='#'>
                    <h2 class="heading"> Facebook </h2>
                    <h4 class="subheading">Click to unlink.  Boring.</h4>
                    </a>
                    </li>
                    
                }
                }
            </ul>
        </div>
    </div>
</div>
@section PageScripts
{
        <script type="text/javascript">
            //wait to do event binding until the page is being initialized
            var socialNeworkController = (function ($, undefined) {
                var pub = {},
                $this = $(this);

                pub.init = function () {

                };

                pub.removeFacebookAccount = function () {
                    //Starting loading animation
                    $.mobile.showPageLoadingMsg();

                    //Get news and add success callback using then
                    removeFacebookAccount(function () {
                        //Stop loading animation on success
                        $.mobile.changePage(getBaseURL() + 'SocialNetworks/Index');

                        $.mobile.hidePageLoadingMsg();
                    });
                };

                function removeFacebookAccount(callback) {
                    //Get news via ajax and return jqXhr
                    $.ajax({
                        url: getBaseURL() + 'SocialNetworks/UnlinkFacebookAccount',
                        dataType: "json",
                        success: function (data, textStatus, xhr) {
                            //Publish that news has been updated & allow
                            //the 2 subscribers to update the UI content
                            if (callback) callback(data);
                        },
                        error: function (data, textStatus, xhr) {
                            //Publish that news has been updated & allow
                            //the 2 subscribers to update the UI content
                            if (callback) callback(data);
                        }
                    });
                }


                return pub;
            }(jQuery));
            $("#socialnetworks-page").unbind('pageshow').bind('pageshow', function () {

                socialNeworkController.init();

                $("#remove-facebook-account").unbind("click").bind("click", function () {
                    socialNeworkController.removeFacebookAccount();
                });
            });

</script>
}

